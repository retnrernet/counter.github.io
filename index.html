<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css">
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css"> 
  <script defer src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
</head>
<body>
  <div>Дата сегодня:<u><label id='time'></label></u></div><button id="clean" type="submit" pys-onClick="clean">Очистить базу операций</button><br>
  <div>Введите название изделия и тип операции или выберите из списка</div>
  <select name="izdelia" id="izdelia">
    <option value="Комбинезон">Комбинезон</option>
    <option value="Юбка">Юбка</option>
    <option value="Лосины">Лосины</option>
    <option value="Леггинсы">Леггинсы</option>
    <option value="Платье">Платье</option>
    <option value="Ражгард">Рашгард</option>
    <option value="Водолазка">Водолазка</option>
    <option value="Шорты">Шорты</option>
    <option value="Футболка">Футболка</option>
    <option value="Топ">Топ</option>
    <option value="Велосипедка">Велосипедка</option>
    <option value="Купальник">Купальник</option>
    <option value="Брюки">Брюки</option>
    <option value="Бюстгалтер">Бюстгалтер</option>
    <option value="Трусы">Трусы</option>
    <option value="Сарафан">Сарафан</option>
    <option value="Боди">Боди</option>
    <option value="Иное">Иное</option>
  </select>
  <select name="operation" id="operation">
    <option value="Обметать боковые срезы">Обметать боковые срезы</option>
    <option value="Вывести концы нитей, протянуть эласт">Вывести концы нитей</option>
    <option value="Стачать эластичную ленту">Стачать эластичную ленту</option>
    <option value="Разложить припуск шва">Разложить припуск шва</option>
    <option value="Наметить место размерника">Наметить место размерника</option>
    <option value="Настрочить размерник">Настрочить размерник</option>
    <option value="Приложить отделочную строчку">Приложить отделочную строчку</option>
    <option value="Наметить контрольные точки">Наметить контрольные точки</option>
    <option value="Настрочить фирмичку">Настрочить фирмичку</option>
    <option value="Закрепить верхнюю часть">Закрепить верхнюю часть</option>
    <option value="Притачать составник">Притачать составник</option>
    <option value="Поставить П-образные закрепки">Поставить П-образные закрепки</option>
    <option value="Скрепить деталь полочки верха">Скрепить деталь полочки верха</option>
    <option value="Вложить боковые срезы">Вложить боковые среды</option>
    <option value="Иное">Иное</option>
  </select>
  <input type="name" id="name"/>
  <div>Введите количество</div>
  <input type="num" id="num"/>
  <div>Введите стоимость за единицу (в формате 0.5 или 5)</div>
  <input type="price" id="price"/>
  <button id="submit-button" type="submit" pys-onClick="my_function">OK</button><br><br>
  <div>Ранее:</div><br>
  <div id="output"></div><br>
  <div>Всего заработано в рублях:</div><br>
  <div id="full"></div><br>
  <button id="download" type="submit" pys-onClick="down">Скачать базу в виде таблицы</button><br>
  <iframe src="https://onlineocr.org/ru#ocr_load" width="100%" height="600" scrolling="no"></iframe><br>
  <div>Вставьте распознанный текст:</div>
  <input type="text" id="text"/><br>
  <button id="ocr" type="submit" pys-onClick="ocr">Сравнить</button><br>
  <div id="ocr"></div><br>
<py-script>
  from datetime import datetime;import js,pyodide,asyncio;from js import document, console,URL, Uint8Array, window, File, Object;from pyodide import create_proxy
  now = datetime.now()
  Element('time').element.innerText = now.strftime("%d/%m/%Y")
  try:Element('output').element.innerText = js.localStorage.getItem("ss");Element('full').element.innerText = js.localStorage.getItem("full")
  except:pass
  def ocr(*args, **kwargs):
    if js.localStorage.getItem("ss") in Element('text').element.value:Element('ocr').element.innerText = "найдено совпадение"
    else: Element('ocr').element.innerText = "не найдено совпадение"
  def my_function(*args, **kwargs):
    name = Element('name').element.value
    num = Element('num').element.value
    price = Element('price').element.value
    izdelia= Element('izdelia').element.value
    operation= Element('operation').element.value
    try:js.localStorage.setItem("ss", js.localStorage.getItem("ss")+"\n"+izdelia+", "+operation+" штук, "+name+", "+num+", "+str(int(num)*float(price))+" руб. итоговая выручка, дата"+now.strftime("%d/%m/%Y"))
    except:js.localStorage.setItem("ss",izdelia+", "+operation+", "+name+", "+num+", "+str(int(num)*float(price))+" руб. итоговая выручка, дата"+now.strftime("%d/%m/%Y"))
    Element('output').element.innerText = js.localStorage.getItem("ss")
    try:js.localStorage.setItem("full", float(js.localStorage.getItem("full"))+(int(num)*float(price)))
    except:js.localStorage.setItem("full", int(num)*float(price))
    Element('full').element.innerText = js.localStorage.getItem("full")
  def clean(*args, **kwargs):
    js.localStorage.removeItem('ss');js.localStorage.removeItem('full')
  def down(*args, **kwargs):
    encoded_data = js.localStorage.getItem("ss").encode('utf-8')
    my_stream = io.BytesIO(encoded_data)
    js_array = Uint8Array.new(len(encoded_data))
    js_array.assign(my_stream.getbuffer())
    file = File.new([js_array], "unused_file_name.txt", {type: "text/plain"})
    url = URL.createObjectURL(file)
    hidden_link = document.createElement("a")
    hidden_link.setAttribute("download", "my_other_file_name.txt")
    hidden_link.setAttribute("href", url)
    hidden_link.click()
</py-script>
  </body>
</html>
